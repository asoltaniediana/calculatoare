<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calculator rambursare anticipată</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
<style>
  /* --- păstrăm stilurile existente --- */

  :root {
    --btn-bg-color: #faa61a;
    --btn-bg-hover: #d48800;
  }

  body {
    font-family: "Source Sans Pro", sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 0;
  }

  main {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
  }

  h1 {
    font-size: 24px;
    color: #222;
    text-align: center;
    margin-bottom: 20px;
  }

  h2 {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    border-bottom: 2px solid #faa61a;
    padding-bottom: 6px;
    margin-bottom: 16px;
  }

  label {
    display: block;
    margin-bottom: 4px;
    font-weight: 600;
    color: #333;
    position: relative;
  }

  input[type="number"],
  select {
    width: 100%;
    font-size: 16px;
    border-radius: 4px;
    border: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box;
    font-family: "Source Sans Pro", sans-serif;
  }

  button {
    background-color: var(--btn-bg-color);
    color: #fff;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
    font-size: 16px;
    border-radius: 6px;
    padding: 10px 20px;
    margin: 20px auto 0;
    display: block;
  }

  button:hover {
    background-color: var(--btn-bg-hover);
  }

  .tooltip-icon {
    display: inline-block;
    background: var(--btn-bg-color);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    text-align: center;
    line-height: 18px;
    font-weight: bold;
    font-size: 14px;
    margin-left: 6px;
    cursor: default;
    position: relative;
  }

  .tooltip-icon:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }

  .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 13px;
    line-height: 1.3;
  }

  .tooltip-text::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
  }

  #resultScadentar,
  #resultRambursare,
  #rataLunaraWrapper {
    max-width: 600px;
    margin: 30px auto 10px;
    padding: 0 20px;
    color: #333;
    font-size: 17px;
    text-align: center;
  }

  #resultScadentar {
    display: none;
    margin-top: 40px;
    border-top: 1px solid #ccc;
    padding-top: 20px;
  }

  #rataLunaraWrapper {
    margin-top: 10px;
    font-weight: 600;
    color: #1a1a1a;
  }

  hr {
    max-width: 600px;
    margin: 40px auto 20px;
    border: none;
    border-bottom: 1px solid #ccc;
  }

  /* === NOU: 2 inputuri pe rand === */

.input-row {
  display: flex;
  gap: 16px;
  margin-top: 16px;
}

.input-row > div {
  flex: 1 1 50%;
  display: flex;
  flex-direction: column; /* label deasupra inputului */
}


  /* Pentru responsive, input-urile pe un singur rand pe mobil */
  @media (max-width: 480px) {
    main,
    #resultScadentar,
    #resultRambursare {
      padding: 15px;
      margin: 10px;
    }

    input[type="number"],
    select,
    button {
      font-size: 14px;
      padding: 8px;
    }

    .input-row {
      flex-direction: column;
    }

    .input-row > label {
      flex: none;
      width: 100%;
    }
  }
</style>

<main>
  <h1>Calculator rambursare anticipată</h1>

  <form id="formRambursare" aria-label="Calculator rambursare anticipată">
    <h2>Rambursare anticipată</h2>

  <div class="input-row">
  <div>
    <label for="soldCredit">Sold credit *</label>
    <input
      type="number"
      id="soldCredit"
      name="soldCredit"
      min="0"
      step="100"
      required
      value="250000"
    />
  </div>

  <div>
    <label for="dobanda">Dobândă anuala (%) *</label>
    <input
      type="number"
      id="dobanda"
      name="dobanda"
      min="0"
      max="100"
      step="0.01"
      value="8"
      required
    />
  </div>
</div>


   <div class="input-row">
  <div>
    <label for="comisionLunar">
      Comision lunar *
      <span class="tooltip-icon">?
        <span class="tooltip-text">Comision lunar aplicat creditului.</span>
      </span>
    </label>
    <input
      type="number"
      id="comisionLunar"
      name="comisionLunar"
      min="0"
      step="0.01"
      value="0"
      required
    />
  </div>

  <div>
    <label for="perioadaRamasa">
      Perioadă rămasă (luni) *
      <span class="tooltip-icon">?
        <span class="tooltip-text">Numărul de luni rămase până la finalizarea creditului.</span>
      </span>
    </label>
    <input
      type="number"
      id="perioadaRamasa"
      name="perioadaRamasa"
      min="1"
      max="1000"
      required
      value="300"
    />
  </div>
</div>

<div class="input-row">
   <div>
    <label for="sumaRambursare">
      Sumă rambursare anticipată *
      <span class="tooltip-icon">?
        <span class="tooltip-text">Suma pe care o vei plăti anticipat.</span>
      </span>
    </label>
    <input
      type="number"
      id="sumaRambursare"
      name="sumaRambursare"
      min="0"
      step="100"
      required
      value="1000"
    />
  </div>
  <div>
    <label for="tipRambursare">
      Tip rambursare anticipată *
      <span class="tooltip-icon">?
        <span class="tooltip-text">Alege dacă rambursarea anticipată este o singură plată sau lunară.</span>
      </span>
    </label>
    <select id="tipRambursare" name="tipRambursare" required>
      <option value="odata">O dată</option>
      <option value="lunara">Lunară</option>
    </select>
  </div>

 
</div>

<div class="input-row">
  <div>
    <label for="modificareCredit">Ce dorești să modifici la credit? *</label>
    <select id="modificareCredit" name="modificareCredit" required>
      <option value="pastrezRata">Păstrez rata (reduc perioada)</option>
      <option value="pastrezPerioada">Păstrez perioada (reduc rata)</option>
    </select>
  </div>

  <div>
    <label for="rataCurenta">Rata curentă</label>
    <input
      type="number"
      id="rataCurenta"
      name="rataCurenta"
      readonly
      
    />
  </div>
</div>


    <button type="submit">CALCULEAZA RAMBURSARE</button>
  </form>

  <div id="resultRambursare" aria-live="polite" style="display: none;"></div>

  <section
    id="scadentarNou"
    style="display: none; max-width: 600px; margin: 30px auto; padding: 0 20px;"
  >
    <h2>Scadentar nou</h2>
    <button
      id="toggleScadentarBtn"
      type="button"
      style="margin-bottom: 12px;"
    >
      ARATA SCADENTAR
    </button>
    <table
      border="1"
      cellpadding="6"
      cellspacing="0"
      style="width: 100%; border-collapse: collapse; display: none;"
    >
      <thead>
        <tr>
          <th>Luni</th>
          <th>Sold Credit</th>
          <th>Principal</th>
          <th>Valoare dobândă</th>
          <th>Rată lunară</th>
        </tr>
      </thead>
      <tbody id="scadentarBody"></tbody>
    </table>
  </section>
</main>

    <script>
    const form = document.getElementById("formRambursare");
const resultRambursare = document.getElementById("resultRambursare");
const modificareCredit = document.getElementById("modificareCredit");
const scadentarNouSection = document.getElementById("scadentarNou");
const scadentarBody = document.getElementById("scadentarBody");
const toggleScadentarBtn = document.getElementById("toggleScadentarBtn");
const scadentarTable = scadentarNouSection.querySelector("table");

function calculeazaRata(sold, dobandaAnuala, luni, comision) {
  const dobandaLunara = dobandaAnuala / 12 / 100;
  if (dobandaLunara === 0) {
    return sold / luni + comision;
  }
  const rataFaraComision = (sold * dobandaLunara) / (1 - Math.pow(1 + dobandaLunara, -luni));
  return rataFaraComision + comision;
}

function calculeazaScadentar(soldInitial, dobandaAnuala, perioada, comision, rataLunara) {
  const dobandaLunara = dobandaAnuala / 12 / 100;
  let sold = soldInitial;
  const scadentar = [];

  for (let luna = 1; luna <= perioada; luna++) {
    const dobanda = sold * dobandaLunara;
    const principal = rataLunara - dobanda - comision;
    sold -= principal;
    if (sold < 0) sold = 0;
    scadentar.push({
      luna,
      sold: sold > 0 ? sold : 0,
      principal: principal > 0 ? principal : 0,
      dobanda: dobanda > 0 ? dobanda : 0,
      rata: rataLunara,
    });
  }

  return scadentar;
}

form.addEventListener("submit", function (e) {
  e.preventDefault();

  // Colectăm datele
  const p = parseFloat(form.soldCredit.value);
  const d = parseFloat(form.dobanda.value);
  const n = parseInt(form.perioadaRamasa.value);
  const c = parseFloat(form.comisionLunar.value);
  const suma = parseFloat(form.sumaRambursare.value);
  const tipModificare = modificareCredit.value;

  if ([p, d, n, c, suma].some(x => isNaN(x) || x < 0) || n === 0) {
    resultRambursare.style.display = "block";
    resultRambursare.textContent = "Completează corect toate câmpurile.";
    return;
  }

  // Rata curentă
  const rataCurenta = calculeazaRata(p, d, n, c);

  let nouaRata, nouaPerioada;

  if (tipModificare === "pastrezRata") {
    // păstrăm rata, reduc perioada
    // Nou sold după rambursare
    const soldNou = p - suma;
    // Calculăm noua perioadă n' cu formula inversă:
    const dobandaLunara = d / 12 / 100;
    if (dobandaLunara === 0) {
      nouaPerioada = Math.ceil(soldNou / (rataCurenta - c));
      nouaRata = rataCurenta;
    } else {
      // n' = -log(1 - dobandaLunara * soldNou / (rataCurenta - c)) / log(1 + dobandaLunara)
      nouaPerioada = Math.ceil(
        -Math.log(1 - (dobandaLunara * soldNou) / (rataCurenta - c)) / Math.log(1 + dobandaLunara)
      );
      nouaRata = rataCurenta;
    }
  } else {
    // păstrăm perioada, reduc rata
    const soldNou = p - suma;
    nouaPerioada = n;
    nouaRata = calculeazaRata(soldNou, d, nouaPerioada, c);
  }

  // Calcul economii dobanda si comisioane
  const totalPlatitInitial = rataCurenta * n;
  const totalPlatitNou = nouaRata * nouaPerioada + suma;
  const dobandaEconomisita = Math.max(0, totalPlatitInitial - totalPlatitNou);
  const comisioaneEconomisite = c * (n - nouaPerioada);

  // Afisare rezultate
  resultRambursare.style.display = "block";
  resultRambursare.innerHTML = `
    <h3>REZULTAT</h3>
    <p><strong>Noua rată lunară:</strong> ${nouaRata.toFixed(2)}</p>
    <p><strong>Noua perioadă rămasă:</strong> ${nouaPerioada} (${nouaPerioada - n > 0 ? '+' : ''}${nouaPerioada - n})</p>
    <p><strong>Total dobândă economisită:</strong> ${dobandaEconomisita.toFixed(2)}</p>
    <p><strong>Total comisioane economisite:</strong> ${comisioaneEconomisite > 0 ? comisioaneEconomisite.toFixed(2) : '0.00'}</p>
  `;

  // Generare scadentar nou (afișare maxim 12 luni ca exemplu)
  const scadentar = calculeazaScadentar(p - suma, d, nouaPerioada, c, nouaRata);

  // Curățăm și populăm tabelul
  scadentarBody.innerHTML = "";
  scadentar.slice(0, 12).forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.luna}</td>
      <td>${row.sold.toFixed(2)}</td>
      <td>${row.principal.toFixed(2)}</td>
      <td>${row.dobanda.toFixed(2)}</td>
      <td>${row.rata.toFixed(2)}</td>
    `;
    scadentarBody.appendChild(tr);
  });

  scadentarNouSection.style.display = "block";
  scadentarTable.style.display = "none";
});

// Toggle scadentar
toggleScadentarBtn.addEventListener("click", () => {
  if (scadentarTable.style.display === "none") {
    scadentarTable.style.display = "table";
    toggleScadentarBtn.textContent = "Ascunde scadentar";
  } else {
    scadentarTable.style.display = "none";
    toggleScadentarBtn.textContent = "Arată scadentar";
  }
});

    </script>
    <script>
  const soldCredit = document.getElementById("soldCredit");
  const dobanda = document.getElementById("dobanda");
  const perioadaRamasa = document.getElementById("perioadaRamasa");
  const comisionLunar = document.getElementById("comisionLunar");
  const rataCurentaInput = document.getElementById("rataCurenta");

  function calculeazaRata(sold, dobandaAnuala, luni, comision) {
    const dobandaLunara = dobandaAnuala / 12 / 100;
    if (dobandaLunara === 0) {
      return sold / luni + comision;
    }
    const rataFaraComision = (sold * dobandaLunara) / (1 - Math.pow(1 + dobandaLunara, -luni));
    return rataFaraComision + comision;
  }

  function actualizeazaRataCurenta() {
    const p = parseFloat(soldCredit.value);
    const d = parseFloat(dobanda.value);
    const n = parseInt(perioadaRamasa.value);
    const c = parseFloat(comisionLunar.value);

    if ([p, d, n, c].some(x => isNaN(x) || x < 0) || n === 0) {
      rataCurentaInput.value = "";
      return;
    }

    const rata = calculeazaRata(p, d, n, c);
    rataCurentaInput.value = rata.toFixed(2);
  }

  // Ascultă modificările pe toate inputurile relevante
  [soldCredit, dobanda, perioadaRamasa, comisionLunar].forEach(el => {
    el.addEventListener("input", actualizeazaRataCurenta);
  });

  // Apelează o dată la încărcare ca să afișeze rata inițială
  actualizeazaRataCurenta();
</script>

  </body>
</html>
