<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Calculator rambursare anticipată</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
<style>
  /* --- păstrăm stilurile existente --- */

  :root {
    --btn-bg-color: #ff4612;
    --btn-bg-hover: #ff4612;
           --text-color: #1e1e1e;
  }

  input[type="number"],
input[type="text"],
select,
textarea {
  font-size: 16px;
}

  body {
    font-family: "Source Sans Pro", sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 0;
  }


  main {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
  }

  h1 {
    font-size: 24px;
    color: var(--text-color);
    text-align: center;
    margin-bottom: 20px;
  }



  h2 {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-color);
  
    padding-bottom: 6px;
    margin-bottom: 16px;
  }

  label {
    display: block;
    margin-bottom: 4px;
    font-weight: 600;
    color:var(--text-color);
    position: relative;
  }

  input[type="number"],
  select {
    width: 100%;
    font-size: 16px;
    border-radius: 4px;
    border: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box;
    font-family: "Source Sans Pro", sans-serif;
  }

  button {
    background-color: var(--btn-bg-color);
    color: #fff;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
    font-size: 16px;
    border-radius: 6px;
    padding: 10px 20px;
    margin: 20px auto 0;
    display: block;
  }

        th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }

      th {
        background-color: #f0f0f0;
        color: var(--text-color);
      }

  button:hover {
    background-color: var(--btn-bg-hover);
  }

  .tooltip-icon {
    display: inline-block;
    background: var(--btn-bg-color);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    text-align: center;
    line-height: 18px;
    font-weight: bold;
    font-size: 14px;
    margin-left: 6px;
    cursor: default;
    position: relative;
  }

  .tooltip-icon:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }

  .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: var(--text-color);
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 13px;
    line-height: 1.3;
  }

  .tooltip-text::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: var(--text-color) transparent transparent transparent;
  }

  #resultScadentar,
  #resultRambursare,
  #rataLunaraWrapper {
    max-width: 600px;
    margin: 30px auto 10px;
    padding: 0 20px;
    color: var(--text-color);
    font-size: 17px;
    text-align: center;
  }

  #resultScadentar {
    display: none;
    margin-top: 40px;
    border-top: 1px solid #ccc;
    padding-top: 20px;
  }

  #rataLunaraWrapper {
    margin-top: 10px;
    font-weight: 600;
    color: var(--text-color);
  }

  hr {
    max-width: 600px;
    margin: 40px auto 20px;
    border: none;
    border-bottom: 1px solid #ccc;
  }

  /* === NOU: 2 inputuri pe rand === */

.input-row {
  display: flex;
  gap: 16px;
  margin-top: 16px;
}

.input-row > div {
  flex: 1 1 50%;
  display: flex;
  flex-direction: column; /* label deasupra inputului */
}


  /* Pentru responsive, input-urile pe un singur rand pe mobil */
  @media (max-width: 480px) {
    main,
    #resultScadentar,
    #resultRambursare {
      padding: 15px;
      margin: 10px;
    }

    input[type="number"],
    select,
    button {
      font-size: 14px;
      padding: 8px;
    }

    .input-row {
      flex-direction: column;
    }

    .input-row > label {
      flex: none;
      width: 100%;
    }
  }
</style>

<main>
  <h1>Calculator rambursare anticipată</h1>

  <form id="formRambursare" aria-label="Calculator rambursare anticipată">
  

  <div class="input-row">
  <div>
    <label for="soldCredit">Sold credit</label>
    <input
      type="number"
      id="soldCredit"
      name="soldCredit"
      min="0"
      step="100"
      required
      value="250000"
    />
  </div>

  <div>
    <label for="dobanda">Dobândă anuala (%)</label>
    <input
      type="number"
      id="dobanda"
      name="dobanda"
      min="0"
      max="100"
      step="0.01"
      value="8"
      required
    />
  </div>
</div>


   <div class="input-row">
  <div>
    <label for="comisionLunar">
      Comision lunar
      <span class="tooltip-icon">?
        <span class="tooltip-text">Comision lunar aplicat creditului.</span>
      </span>
    </label>
    <input
      type="number"
      id="comisionLunar"
      name="comisionLunar"
      min="0"
      step="0.01"
      value="0"
      required
    />
  </div>

  <div>
    <label for="perioadaRamasa">
      Perioadă rămasă (luni)
      <span class="tooltip-icon">?
        <span class="tooltip-text">Numărul de luni rămase până la finalizarea creditului.</span>
      </span>
    </label>
    <input
      type="number"
      id="perioadaRamasa"
      name="perioadaRamasa"
      min="1"
      max="1000"
      required
      value="300"
    />
  </div>
</div>

<div class="input-row">
   <div>
    <label for="sumaRambursare">
      Sumă rambursare anticipată
      <span class="tooltip-icon">?
        <span class="tooltip-text">Suma pe care o vei plăti anticipat (o data).</span>
      </span>
    </label>
    <input
      type="number"
      id="sumaRambursare"
      name="sumaRambursare"
      min="0"
      step="100"
      required
      value="1000"
    />
  </div>
  <div>
    
  </div>

 
</div>

<div class="input-row">
  <div>
    <label for="modificareCredit">Ce dorești să modifici la credit?</label>
    <select id="modificareCredit" name="modificareCredit" required>
      <option value="pastrezRata">Păstrez rata (reduc perioada)</option>
      <option value="pastrezPerioada">Păstrez perioada (reduc rata)</option>
    </select>
  </div>

  <div>
    <label for="rataCurenta">Rata curentă</label>
    <input
      type="number"
      id="rataCurenta"
      name="rataCurenta"
      readonly
      
    />
  </div>
</div>


    <button type="submit">CALCULEAZA RAMBURSARE</button>
  </form>

  <div id="resultRambursare" aria-live="polite" style="display: none;"></div>

 <button id="toggleScadentarBtn" type="button" style="display:none; margin-top: 1rem;">ARATA SCADENTAR</button>

<section id="scadentarNou" style="display:none; margin-top: 1rem;">
  <h2>Scadentar nou</h2>
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>Luna</th>
        <th>Sold</th>
        <th>Principal</th>
        <th>Dobândă</th>
        <th>Rată</th>
      </tr>
    </thead>
    <tbody id="scadentarBody"></tbody>
  </table>
</section>

</main>
<script>
const form = document.getElementById("formRambursare");
const resultRambursare = document.getElementById("resultRambursare");
const modificareCredit = document.getElementById("modificareCredit");
const scadentarNouSection = document.getElementById("scadentarNou");
const scadentarBody = document.getElementById("scadentarBody");
const toggleScadentarBtn = document.getElementById("toggleScadentarBtn");

function calculeazaRata(sold, dobandaAnuala, luni, comision) {
  const dobandaLunara = dobandaAnuala / 12 / 100;
  if (dobandaLunara === 0) {
    return sold / luni + comision;
  }
  const rataFaraComision = (sold * dobandaLunara) / (1 - Math.pow(1 + dobandaLunara, -luni));
  return rataFaraComision + comision;
}

function calculeazaScadentar(soldInitial, dobandaAnuala, perioada, comision, rataLunara) {
  const dobandaLunara = dobandaAnuala / 12 / 100;
  let sold = soldInitial;
  const scadentar = [];

  for (let luna = 1; luna <= perioada; luna++) {
    const dobanda = sold * dobandaLunara;
    const principal = rataLunara - dobanda - comision;
    sold -= principal;
    if (sold < 0) sold = 0;
    scadentar.push({
      luna,
      sold,
      principal,
      dobanda,
      rata: rataLunara,
    });
  }

  return scadentar;
}

form.addEventListener("submit", function (e) {
  e.preventDefault();

  const p = parseFloat(form.soldCredit.value);
  const d = parseFloat(form.dobanda.value);
  const n = parseInt(form.perioadaRamasa.value);
  const c = parseFloat(form.comisionLunar.value);
  const suma = parseFloat(form.sumaRambursare.value);
  const tipModificare = modificareCredit.value;

  if ([p, d, n, c, suma].some(x => isNaN(x) || x < 0) || n === 0) {
    resultRambursare.style.display = "block";
    resultRambursare.textContent = "Completeaza corect toate campurile.";
    toggleScadentarBtn.style.display = "none";
    scadentarNouSection.style.display = "none";
    return;
  }

  const rataCurenta = calculeazaRata(p, d, n, c);
  let nouaRata = 0;
  let nouaPerioada = 0;

  const dobandaLunara = d / 12 / 100;

 
    const soldNou = Math.max(p - suma, 0);
    if (tipModificare === "pastrezRata") {
      if (dobandaLunara === 0) {
        nouaPerioada = Math.ceil(soldNou / (rataCurenta - c));
        nouaRata = rataCurenta;
      } else {
        nouaPerioada = Math.ceil(
          -Math.log(1 - (dobandaLunara * soldNou) / (rataCurenta - c)) / Math.log(1 + dobandaLunara)
        );
        nouaRata = rataCurenta;
      }
    } else {
      nouaPerioada = n;
      nouaRata = calculeazaRata(soldNou, d, nouaPerioada, c);
    }
  

  const totalPlatitInitial = rataCurenta * n;
  const totalPlatitNou = nouaRata * nouaPerioada + suma;
  const dobandaEconomisita = Math.max(0, totalPlatitInitial - totalPlatitNou);
  const comisioaneEconomisite = c * (n - nouaPerioada);

  resultRambursare.style.display = "block";
  resultRambursare.innerHTML = `
    <h3>REZULTAT</h3>
    <p><strong>Noua rata lunara:</strong> ${nouaRata.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
    <p><strong>Noua perioada ramasa:</strong> ${nouaPerioada} (${nouaPerioada - n >= 0 ? "+" : ""}${nouaPerioada - n})</p>
    <p><strong>Total dobanda economisita:</strong> ${dobandaEconomisita.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
    <p><strong>Total comisioane economisite:</strong> ${comisioaneEconomisite > 0 ? comisioaneEconomisite.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "0.00"}</p>
  `;

  scadentarBody.innerHTML = "";
  const scadentar = calculeazaScadentar(p - suma, d, nouaPerioada, c, nouaRata);
  scadentar.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.luna}</td>
      <td>${row.sold.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
      <td>${row.principal.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
      <td>${row.dobanda.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
      <td>${row.rata.toLocaleString('ro-RO', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
    `;
    scadentarBody.appendChild(tr);
  });

  scadentarNouSection.style.display = "none";
  toggleScadentarBtn.style.display = "block";
  toggleScadentarBtn.textContent = "ARATA SCADENTAR";
});

toggleScadentarBtn.addEventListener("click", () => {
  if (scadentarNouSection.style.display === "none") {
    scadentarNouSection.style.display = "block";
    toggleScadentarBtn.textContent = "ASCUNDE SCADENTAR";
  } else {
    scadentarNouSection.style.display = "none";
    toggleScadentarBtn.textContent = "ARATA SCADENTAR";
  }
});

const soldCredit = document.getElementById("soldCredit");
const dobanda = document.getElementById("dobanda");
const perioadaRamasa = document.getElementById("perioadaRamasa");
const comisionLunar = document.getElementById("comisionLunar");
const rataCurentaInput = document.getElementById("rataCurenta");

function actualizeazaRataCurenta() {
  const p = parseFloat(soldCredit.value);
  const d = parseFloat(dobanda.value);
  const n = parseInt(perioadaRamasa.value);
  const c = parseFloat(comisionLunar.value);

  if ([p, d, n, c].some(x => isNaN(x) || x < 0) || n === 0) {
    rataCurentaInput.value = "";
    return;
  }

  const rata = calculeazaRata(p, d, n, c);
  rataCurentaInput.value = rata.toFixed(2);
}

[soldCredit, dobanda, perioadaRamasa, comisionLunar].forEach(el => {
  el.addEventListener("input", actualizeazaRataCurenta);
});

actualizeazaRataCurenta();
</script>



  </body>
</html>
